{"ID":"20241102232347-bhbapzn","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241102232347-bhbapzn","title":"参考文章 Nginx 还能这么玩","type":"doc","updated":"20241102233207"},"Children":[{"ID":"20241102232707-sfn1uu5","Type":"NodeParagraph","Properties":{"id":"20241102232707-sfn1uu5","updated":"20241102232852"},"Children":[{"Type":"NodeText","Data":"原文："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mp.weixin.qq.com/s/Z1M7deaYrLJUjDoSBt-JLQ","TextMarkTextContent":"不敢相信，Nginx 还能这么玩？（程序员鱼皮）"}]},{"ID":"20241102232557-fpv16e3","Type":"NodeIFrame","Data":"\u003ciframe sandbox=\"allow-forms allow-presentation allow-same-origin allow-scripts allow-modals allow-popups\" src=\"https://mp.weixin.qq.com/s/Z1M7deaYrLJUjDoSBt-JLQ\" data-src=\"\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"width: 1107px; height: 568px;\"\u003e\u003c/iframe\u003e","Properties":{"id":"20241102232557-fpv16e3","updated":"20241102232632"}},{"ID":"20241102232648-otaukto","Type":"NodeParagraph","Properties":{"id":"20241102232648-otaukto","updated":"20241102232648"}},{"ID":"20241102232837-v528cid","Type":"NodeParagraph","Properties":{"id":"20241102232837-v528cid","updated":"20241102232837"}},{"ID":"20241102232825-oujvb1w","Type":"NodeParagraph","Properties":{"id":"20241102232825-oujvb1w","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"大家好，我是程序员鱼皮。今天来聊聊 Nginx 技术，这是一个企业项目必用，但是却经常被程序员忽略的技术。学好 Nginx，可以助你在求职中脱颖而出。"}]},{"ID":"20241102232825-tu5g9io","Type":"NodeParagraph","Properties":{"id":"20241102232825-tu5g9io","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"或许你会想：“Nginx 不就是用来部署网站的服务器嘛？这有何难？”"}]},{"ID":"20241102232825-p8ghzps","Type":"NodeParagraph","Properties":{"id":"20241102232825-p8ghzps","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"但其实这不过是九牛一毛罢了，Nginx 的实用操作和使用技巧还多着呢，下面这篇文章，就带大家轻松入门 Nginx、并且循序渐进地学习 Nginx 真正的用法！"}]},{"ID":"20241102232825-yl93vyy","Type":"NodeBlockquote","Properties":{"id":"20241102232825-yl93vyy","updated":"20241102232825"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20241102232825-bxsu955","Type":"NodeParagraph","Properties":{"id":"20241102232825-bxsu955","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"推荐观看本文对应的视频版本，有更多操作演示哦："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"https://bilibili.com/video/BV1TW1LYkE59"}]}]},{"ID":"20241102232825-cf8fvlc","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241102232825-cf8fvlc","updated":"20241102233022"},"Children":[{"Type":"NodeText","Data":"一、Nginx 入门 - 牛刀小试"}]},{"ID":"20241102232825-nvd2otu","Type":"NodeParagraph","Properties":{"id":"20241102232825-nvd2otu","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"首先要了解什么是 Nginx？注意读音，是 Engine X，而不是恩静因克斯。"}]},{"ID":"20241102232825-8pwqgce","Type":"NodeParagraph","Properties":{"id":"20241102232825-8pwqgce","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"根据官方定义，它是世界上最受欢迎的 Web 服务器、高性能负载均衡器、反向代理、API 网关和内容缓存。"}]},{"ID":"20241102232825-f302o00","Type":"NodeParagraph","Properties":{"id":"20241102232825-f302o00","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"虽然听不懂，但是感觉很厉害的样子。"}]},{"ID":"20241102232825-w3brjyb","Type":"NodeParagraph","Properties":{"id":"20241102232825-w3brjyb","updated":"20241102233014"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233007-ys59jsn.jpg"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232825-mw8j9mh","Type":"NodeParagraph","Properties":{"id":"20241102232825-mw8j9mh","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"简单来说，Nginx 不仅能部署网站，而且相比其他的 Web 服务器，它能够用更少的资源，同时处理更多用户的请求，让网站速度更快更稳定，这也是企业选择 Nginx 的原因。"}]},{"ID":"20241102232825-xvyfedc","Type":"NodeParagraph","Properties":{"id":"20241102232825-xvyfedc","updated":"20241102232825"},"Children":[{"Type":"NodeText","Data":"下面我们就牛刀小试，用 Nginx 启动一个网站！"}]},{"ID":"20241102232929-jlu0vl4","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-jlu0vl4","updated":"20241102233022"},"Children":[{"Type":"NodeText","Data":"1、Nginx 安装"}]},{"ID":"20241102232929-kzlaetf","Type":"NodeParagraph","Properties":{"id":"20241102232929-kzlaetf","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"首先我们需要安装 Nginx ，先到官网中根据操作系统下载一个稳定版本的压缩包，下载完成之后解压一下。"}]},{"ID":"20241102232929-9ha83g8","Type":"NodeParagraph","Properties":{"id":"20241102232929-9ha83g8","updated":"20241102233019"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233007-zeq4b8l.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-4izywoj","Type":"NodeParagraph","Properties":{"id":"20241102232929-4izywoj","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"如果是 Windows 系统，双击 exe 文件启动即可；如果是 Mac 或 Linux 系统，可以打开终端并进入该目录，手动编译安装后执行 Nginx 命令启动。"}]},{"ID":"20241102232929-0wusvgf","Type":"NodeParagraph","Properties":{"id":"20241102232929-0wusvgf","updated":"20241102233020"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233007-48n3xpf.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-5m1ko2f","Type":"NodeParagraph","Properties":{"id":"20241102232929-5m1ko2f","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"当然也可以使用第三方的包管理工具，比如 Chocolatey（Windows）、Homebrew（Mac）、Yum（Linux）。"}]},{"ID":"20241102232929-8leqy88","Type":"NodeParagraph","Properties":{"id":"20241102232929-8leqy88","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"或者使用现成的服务器运维面板，比如宝塔 Linux，可以傻瓜式一键安装："}]},{"ID":"20241102232929-ivs8i46","Type":"NodeParagraph","Properties":{"id":"20241102232929-ivs8i46","updated":"20241102233022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233007-rhkastp.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-sl0hugd","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-sl0hugd","updated":"20241102233053"},"Children":[{"Type":"NodeText","Data":"2、修改网页文件"}]},{"ID":"20241102232929-omox4oc","Type":"NodeParagraph","Properties":{"id":"20241102232929-omox4oc","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"启动成功后，我们访问本机域名 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"localhost:80"},{"Type":"NodeText","Data":"​  （80 为默认端口，可以省略），就可以看到 Nginx 为我们提供的默认网站了。"}]},{"ID":"20241102232929-y98djsn","Type":"NodeParagraph","Properties":{"id":"20241102232929-y98djsn","updated":"20241102233040"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-od6s3qp.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-i6ab1bc","Type":"NodeParagraph","Properties":{"id":"20241102232929-i6ab1bc","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"那如果想自己修改网页内容，怎么办呢？"}]},{"ID":"20241102232929-ml6o08c","Type":"NodeParagraph","Properties":{"id":"20241102232929-ml6o08c","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"我们要找到 Nginx 的大脑，也就是配置文件。进入配置目录 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"conf"},{"Type":"NodeText","Data":"​ ，就可以看到配置文件 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx.conf"},{"Type":"NodeText","Data":"​ 了。配置文件由块和指令组成，可以通过修改配置实现各种功能，比如通过 location 块和 root 指令配置网站文件的根路径："}]},{"ID":"20241102232929-un9bqwn","Type":"NodeParagraph","Properties":{"id":"20241102232929-un9bqwn","updated":"20241102233049"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-4qbg8rl.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-4kehl07","Type":"NodeParagraph","Properties":{"id":"20241102232929-4kehl07","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"我们找到这个 index.html 文件，修改网页的内容并保存："}]},{"ID":"20241102232929-vwug7md","Type":"NodeParagraph","Properties":{"id":"20241102232929-vwug7md","updated":"20241102233051"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-jd7nzww.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-7j1wjyi","Type":"NodeParagraph","Properties":{"id":"20241102232929-7j1wjyi","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"重新访问就可以看到效果啦！"}]},{"ID":"20241102232929-n1paiys","Type":"NodeParagraph","Properties":{"id":"20241102232929-n1paiys","updated":"20241102233053"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-i8q865d.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-182z8qb","Type":"NodeParagraph","Properties":{"id":"20241102232929-182z8qb","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"看到这里，恭喜你，已经超过 30% 的程序员了！"}]},{"ID":"20241102232929-rt8cwfg","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241102232929-rt8cwfg","updated":"20241102233119"},"Children":[{"Type":"NodeText","Data":"二、Nginx 常用操作 - 明劲"}]},{"ID":"20241102232929-meznre9","Type":"NodeParagraph","Properties":{"id":"20241102232929-meznre9","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"下面，我们要成为 Nginx 明劲武者。所谓明劲，就是要熟悉 Nginx 的基本配置和常用操作，能够满足企业开发中的大多数需求，如果你的目标是开发岗，那么学完下面这些就足够找工作了。"}]},{"ID":"20241102232929-iz8se20","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-iz8se20","updated":"20241102233119"},"Children":[{"Type":"NodeText","Data":"1、静态文件服务"}]},{"ID":"20241102232929-kfltvkn","Type":"NodeParagraph","Properties":{"id":"20241102232929-kfltvkn","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"我们开发好的网站，通常包含像 HTML、CSS、JavaScript、图片等文件，由于这些文件的内容在存储时是固定的，被称为静态文件。"}]},{"ID":"20241102232929-86r7p3l","Type":"NodeParagraph","Properties":{"id":"20241102232929-86r7p3l","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"如果你要让别人访问到开发好的网站，只把网站文件放到服务器上还是不够的，还需要一个 Web 服务器，能够接受用户的访问请求，并找到对应位置的文件进行响应。"}]},{"ID":"20241102232929-3u9yjpi","Type":"NodeParagraph","Properties":{"id":"20241102232929-3u9yjpi","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"Nginx 最基本的功能，就是作为 Web 服务器提供静态文件服务。"}]},{"ID":"20241102232929-u2v8uye","Type":"NodeParagraph","Properties":{"id":"20241102232929-u2v8uye","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"打开 Nginx 的配置文件 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx.conf"},{"Type":"NodeText","Data":"​ ，添加 location 块，用于根据请求地址处理请求。比如我们通过 root 指令定义静态文件根目录，通过 index 指令定义默认首页文件："}]},{"ID":"20241102232929-32d667v","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-32d667v","updated":"20241102233110"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bmdpbng="},{"Type":"NodeCodeBlockCode","Data":"server {\n  listen       80;\n  server_name  localhost;\n\n  location / {\n    root /tmp/nginx/html;  # 指定静态文件根目录\n    index index.html;  # 默认首页\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-ndxo7yz","Type":"NodeParagraph","Properties":{"id":"20241102232929-ndxo7yz","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"保存配置，然后执行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx -s reload"},{"Type":"NodeText","Data":"​ 命令来重载配置，再次访问网站时就会返回刚配置的目录下的首页文件。"}]},{"ID":"20241102232929-1cs5v86","Type":"NodeParagraph","Properties":{"id":"20241102232929-1cs5v86","updated":"20241102233114"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-th67ut0.jpg"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-p7atne6","Type":"NodeParagraph","Properties":{"id":"20241102232929-p7atne6","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"企业项目中，需要为特定路径定义不同的处理规则，location 块的配置会更复杂。支持根据请求路径的特定部分、正则表达式等进行匹配，比如到特定目录去寻找图片："}]},{"ID":"20241102232929-v4r45cd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-v4r45cd","updated":"20241102233119"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bmdpbng="},{"Type":"NodeCodeBlockCode","Data":"server {\n  listen 80;                          # 监听 80 端口\n  server_name example.com;            # 指定域名\n\n  # 根路径的配置，返回静态文件\n  location / {\n    root /var/www/html;             # 指向静态文件的根目录\n    index index.html;               # 默认首页文件\n    try_files $uri $uri/ =404;     # 如果文件不存在，则返回 404\n  }\n\n  # 处理以 /images/ 开头的请求\n  location /images/ {\n    root /var/www/assets/images/;  # 指向图片目录\n  }\n\n  # 正则匹配，处理以 .php 结尾的请求\n  location ~ \\.php$ {\n    include fastcgi_params;          # 包含 FastCGI 参数\n    fastcgi_pass 127.0.0.1:9000;    # 将请求转发到 FastCGI 处理程序\n    fastcgi_index index.php;         # 设置 FastCGI 的默认索引文件\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  # 定义脚本文件名\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-j1lgneb","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-j1lgneb","updated":"20241102233207"},"Children":[{"Type":"NodeText","Data":"2、反向代理"}]},{"ID":"20241102232929-qxw2yu0","Type":"NodeParagraph","Properties":{"id":"20241102232929-qxw2yu0","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"Nginx 的另一个常用功能是用作反向代理服务器。什么是反向代理呢？一句话：Nginx 作为中介，帮后端服务器接受请求。"}]},{"ID":"20241102232929-cijxk5v","Type":"NodeParagraph","Properties":{"id":"20241102232929-cijxk5v","updated":"20241102233142"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);","style":"width: 700px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-hxbze0d.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 700px;\" parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-wzyjp6j","Type":"NodeParagraph","Properties":{"id":"20241102232929-wzyjp6j","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"反向代理有什么作用呢？"}]},{"ID":"20241102232929-9r0y21v","Type":"NodeParagraph","Properties":{"id":"20241102232929-9r0y21v","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"首先是请求转发和解决跨域。比如在 location 块中添加 proxy"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"pass 配置，可以将 Nginx 在 80 端口收到的 /api 路径的请求转发到本地 8080 端口的后端服务。"}]},{"ID":"20241102232929-coijw6f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-coijw6f","updated":"20241102233201"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bmdpbng="},{"Type":"NodeCodeBlockCode","Data":"server {\n    listen 80;  # 监听 80 端口\n    server_name localhost;  # 替换为你的域名或 IP 地址\n\n    location /api {\n        proxy_pass http://localhost:8080;  # 代理到本地的 8080 端口\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-6co8huy","Type":"NodeParagraph","Properties":{"id":"20241102232929-6co8huy","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样就隐藏了后端服务器的 IP 地址，让客户端完全感知不到后端服务器的存在，更加安全。"}]},{"ID":"20241102232929-iogvbxu","Type":"NodeParagraph","Properties":{"id":"20241102232929-iogvbxu","updated":"20241102233204"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);","style":"width: 684px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-tkt9x3a.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 684px;\" parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-w1essua","Type":"NodeParagraph","Properties":{"id":"20241102232929-w1essua","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"而且还能让前端和后端的域名统一，解决了跨域问题。"}]},{"ID":"20241102232929-8x9k168","Type":"NodeParagraph","Properties":{"id":"20241102232929-8x9k168","updated":"20241102233206"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);","style":"width: 700px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-z0ctytx.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 700px;\" parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-v8ql62y","Type":"NodeParagraph","Properties":{"id":"20241102232929-v8ql62y","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"反向代理还可以用于实现负载均衡。由于企业项目的流量巨大，通常需要有多台后端服务器。Nginx 可以作为高性能网关，统一接收请求，并将请求按照特定规则转发到不同的后端服务器进行处理，从而分散了请求压力，避免单一服务器过载。"}]},{"ID":"20241102232929-k0q3ctj","Type":"NodeParagraph","Properties":{"id":"20241102232929-k0q3ctj","updated":"20241102233207"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);","style":"width: 730px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-9cf9mhf.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 730px;\" parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-q7dxdv5","Type":"NodeParagraph","Properties":{"id":"20241102232929-q7dxdv5","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"在 Nginx 中实现负载均衡非常简单，首先通过 upstream 块定义了一个名为 backend 的服务器组，其中包含两个后端服务器，然后通过反向代理配置将请求转发到这个服务器组即可："}]},{"ID":"20241102232929-21il0lm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-21il0lm","updated":"20241102233211"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bmdpbng="},{"Type":"NodeCodeBlockCode","Data":"upstream backend {\n  server localhost:8080;  # 第一个后端服务器\n  server localhost:8081;  # 第二个后端服务器\n}\n\nserver {\n  listen 80;\n  server_name localhost;\n\n  location /api {\n    proxy_pass http://backend;  # 代理到负载均衡的后端服务器\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-8oid4qz","Type":"NodeParagraph","Properties":{"id":"20241102232929-8oid4qz","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样每次都访问同一个地址，会交替返回两种不同的内容，这是因为 Nginx 的默认负载均衡算法是轮询，请求会被平均转发到两个不同的服务进行处理。"}]},{"ID":"20241102232929-3e1vbka","Type":"NodeParagraph","Properties":{"id":"20241102232929-3e1vbka","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"反向代理还有更多的作用，比如缓存常见请求的响应、减少后端负担，集中处理 SSL 加密、认证和日志记录等功能，后面会依次讲解。"}]},{"ID":"20241102232929-flk3dzp","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-flk3dzp","updated":"20241102233218"},"Children":[{"Type":"NodeText","Data":"3、改写请求和响应"}]},{"ID":"20241102232929-3opsmnv","Type":"NodeParagraph","Properties":{"id":"20241102232929-3opsmnv","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"第三个 Nginx 的常用功能是改写请求和响应。在请求到达服务器或响应返回给客户端之前，Nginx 可以对其进行修改。"}]},{"ID":"20241102232929-5oj3hnt","Type":"NodeParagraph","Properties":{"id":"20241102232929-5oj3hnt","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"改写请求与响应有什么作用呢？有几个比较典型的场景："}]},{"ID":"20241102232929-31wci7p","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-31wci7p","updated":"20241102233218"},"Children":[{"Type":"NodeText","Data":"1）控制浏览器缓存"}]},{"ID":"20241102232929-7flv0yg","Type":"NodeParagraph","Properties":{"id":"20241102232929-7flv0yg","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"首先，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"设置响应头"},{"Type":"NodeText","Data":" 可以帮助我们控制浏览器缓存。通过 Nginx 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"add_header"},{"Type":"NodeText","Data":"​ 指令，可以为响应添加自定义的 HTTP 头部，从而指导浏览器如何处理缓存。比如设置缓存有效期为 30 天："}]},{"ID":"20241102232929-qvnx36h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-qvnx36h","updated":"20241102233215"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bmdpbng="},{"Type":"NodeCodeBlockCode","Data":"location /images/ {\n    root /tmp/nginx/html;\n    expires 30d;  # 设置缓存有效期为 30 天\n    add_header Cache-Control \"public\";  # 设置缓存头\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-v3mascf","Type":"NodeParagraph","Properties":{"id":"20241102232929-v3mascf","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样，当用户访问图片时，浏览器会在本地缓存这些图片，下次访问时就不用访问服务器了，提高速度并减少对服务器的请求。"}]},{"ID":"20241102232929-dn7n782","Type":"NodeParagraph","Properties":{"id":"20241102232929-dn7n782","updated":"20241102233218"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"min-width: calc(100% - 0.1em);"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-qpv16fh.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"min-width: calc(100% - 0.1em);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-jav2xrd","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-jav2xrd","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"2）重定向"}]},{"ID":"20241102232929-zw0h5dd","Type":"NodeParagraph","Properties":{"id":"20241102232929-zw0h5dd","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"请求重定向允许我们将请求从一个地址自动引导到另一个地址，常见的应用场景包括将 HTTP 请求重定向到 HTTPS，或者将旧地址重定向到新地址。"}]},{"ID":"20241102232929-gop9gq0","Type":"NodeParagraph","Properties":{"id":"20241102232929-gop9gq0","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"在 Nginx 中，可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"return"},{"Type":"NodeText","Data":"​ 指令 + 302 状态码配置重定向："}]},{"ID":"20241102232929-uc77b27","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-uc77b27","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"location /old-page {\n    return 302 https://codefather.cn  # 重定向到新页面\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-qho54fp","Type":"NodeParagraph","Properties":{"id":"20241102232929-qho54fp","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"当用户访问某个过期页面时，会被重定向自动跳转到新网站。"}]},{"ID":"20241102232929-egfih2b","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-egfih2b","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"3）URI 重写"}]},{"ID":"20241102232929-h9u3zy9","Type":"NodeParagraph","Properties":{"id":"20241102232929-h9u3zy9","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"比重定向更高级一些，Nginx 提供了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rewrite"},{"Type":"NodeText","Data":"​ 指令，支持正则表达式，可以非常灵活地将请求重写为不同的路径或网站。比如将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/api/v1/users"},{"Type":"NodeText","Data":"​ 的请求重写为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/api/users"},{"Type":"NodeText","Data":"​："}]},{"ID":"20241102232929-etq2t3z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-etq2t3z","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"location /api/v1/ {\n    rewrite ^/api/v1/(.*)$ /api/$1 break;  # 将 /api/v1/ 的请求重写为 /api/\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-pm8ueku","Type":"NodeParagraph","Properties":{"id":"20241102232929-pm8ueku","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样一来，后端就不用再关注 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/api/v1/"},{"Type":"NodeText","Data":"​ 的存在了，这种方法在网站迁移或者结构调整时非常有用。大家也不用去记忆改写的具体语法，随用随查就行。"}]},{"ID":"20241102232929-4ph4kd6","Type":"NodeThematicBreak","Properties":{"id":"20241102232929-4ph4kd6","updated":"20241102232929"}},{"ID":"20241102232929-9u84hfy","Type":"NodeParagraph","Properties":{"id":"20241102232929-9u84hfy","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"看到这里，恭喜你，超过 60% 的程序员了。"}]},{"ID":"20241102232929-z9wl8x1","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241102232929-z9wl8x1","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"三、Nginx 高级操作 - 暗劲"}]},{"ID":"20241102232929-gk67rlt","Type":"NodeParagraph","Properties":{"id":"20241102232929-gk67rlt","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"下面，我们要成为 Nginx 的暗劲高手。所谓暗劲，又分为 2 种境界。"}]},{"ID":"20241102232929-crngcc9","Type":"NodeList","ListData":{},"Properties":{"id":"20241102232929-crngcc9","updated":"20241102232929"},"Children":[{"ID":"20241102232929-iif21he","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-iif21he","updated":"20241102232929"},"Children":[{"ID":"20241102232929-9a6f007","Type":"NodeParagraph","Properties":{"id":"20241102232929-9a6f007","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"熟悉 Nginx 的各种特性和高级配置，能更快速地配置和管理 Nginx，为小圆满"}]}]},{"ID":"20241102232929-6ugimks","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-6ugimks","updated":"20241102232929"},"Children":[{"ID":"20241102232929-dksmjp7","Type":"NodeParagraph","Properties":{"id":"20241102232929-dksmjp7","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"熟悉 Nginx 工具和模块生态，能够灵活运用 Nginx 进行架构设计、并巧妙地解决各种需求，为大圆满。"}]}]}]},{"ID":"20241102232929-olxgd3p","Type":"NodeParagraph","Properties":{"id":"20241102232929-olxgd3p","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"暗劲境界的高手，挑战大厂开发、架构师、高级系统管理员岗位，不成问题。"}]},{"ID":"20241102232929-xbr4ohf","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-xbr4ohf","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"1、Nginx 高级配置"}]},{"ID":"20241102232929-38bu7nv","Type":"NodeParagraph","Properties":{"id":"20241102232929-38bu7nv","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"我们先挑战小圆满，Nginx 的配置项实在是太多了，这里我就挑选几个相对实用的来讲解。"}]},{"ID":"20241102232929-u5vl83y","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-u5vl83y","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"1）日志记录"}]},{"ID":"20241102232929-byy1272","Type":"NodeParagraph","Properties":{"id":"20241102232929-byy1272","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"为了分析网站流量、用户行为和报错信息，我们可以开启 Nginx 日志功能。分为访问日志和错误日志。"}]},{"ID":"20241102232929-u53o6v9","Type":"NodeParagraph","Properties":{"id":"20241102232929-u53o6v9","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"访问日志会记录所有请求的信息，更全面，可以通过修改 access"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log 指令调整日志存储路径："}]},{"ID":"20241102232929-ldue0w5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-ldue0w5","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"http {\n  log_format custom_format 'yupi $remote_addr - $remote_user [$time_local] \"$request\" '\n                          '$status $body_bytes_sent \"$http_referer\" '\n                          '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n  \n  access_log /rap/access.log custom_format;  # 配置访问日志\n\n  server {\n    listen       80;\n    server_name  localhost;\n  \n    location / {\n      root /tmp/nginx/html;  # 指定静态文件根目录\n      index index.html;  # 默认首页\n    }\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-vg6cftb","Type":"NodeParagraph","Properties":{"id":"20241102232929-vg6cftb","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"而错误日志仅记录 Nginx 在处理请求时遇到的问题，错误又分为 8 个级别："}]},{"ID":"20241102232929-yubn3vq","Type":"NodeParagraph","Properties":{"id":"20241102232929-yubn3vq","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-bkr1vrc.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-epraapr","Type":"NodeParagraph","Properties":{"id":"20241102232929-epraapr","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"可以为不同的级别指定不同的日志输出路径："}]},{"ID":"20241102232929-9geaeet","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-9geaeet","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"access_log /rap/access.log custom_format;  # 配置访问日志\nerror_log /rap/error.log error;  # 配置错误日志\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-h7rbe7f","Type":"NodeParagraph","Properties":{"id":"20241102232929-h7rbe7f","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"开启日志功能后，就能直接在文件中查看日志了。"}]},{"ID":"20241102232929-cxplatj","Type":"NodeParagraph","Properties":{"id":"20241102232929-cxplatj","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-ix3wstr.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-ws7ivmv","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-ws7ivmv","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"2）访问控制"}]},{"ID":"20241102232929-sr4q9et","Type":"NodeParagraph","Properties":{"id":"20241102232929-sr4q9et","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"如果有恶意用户攻击我们的网站，怎么办？"}]},{"ID":"20241102232929-msf3190","Type":"NodeParagraph","Properties":{"id":"20241102232929-msf3190","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"莫慌，Nginx 提供了访问控制功能，可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"allow"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"deny"},{"Type":"NodeText","Data":"​ 指令对 IP 访问进行限制，比如不让 127.0.0.1 这个 IP 访问："}]},{"ID":"20241102232929-oubjgd1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-oubjgd1","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"server {\n    listen 80;\n    server_name localhost;\n\n    location / {\n        # 拒绝特定 IP 地址\n        deny 127.0.0.1;\n        # 除了写具体 ip 外，也可以写网段\n        deny 192.168.1.0/24;\n        # 允许所有其他 IP 地址\n        allow all;\n        proxy_pass http://localhost:8081;\n  \n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-w44m22g","Type":"NodeParagraph","Properties":{"id":"20241102232929-w44m22g","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样一来，攻击者就访问不了网站了！"}]},{"ID":"20241102232929-k06zw1y","Type":"NodeParagraph","Properties":{"id":"20241102232929-k06zw1y","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-k3q8c5n.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-c38qa53","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-c38qa53","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"3）限流"}]},{"ID":"20241102232929-rup3oiu","Type":"NodeParagraph","Properties":{"id":"20241102232929-rup3oiu","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"为了保护网站，我们还可以使用 Nginx 的限流功能。比如下面这段配置，通过定义请求限流区域并应用于根路径，限制每个 IP 地址在一分钟内最多只能发送 2 个请求。"}]},{"ID":"20241102232929-2e1iybr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-2e1iybr","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 定义限流区域，使用客户端的二进制 IP 地址作为唯一标识\n# zone=one:10m 表示创建一个名为 \"one\" 的内存区域，大小为 10MB\n# rate=2r/m 表示每个 IP 地址每分钟最多允许 2 个请求\nlimit_req_zone $binary_remote_addr zone=one:10m rate=2r/m;\n\nserver {\n  listen 80;  # 监听 80 端口，接收 HTTP 请求\n  server_name localhost;  # 设置服务器名称为 localhost\n\n  location / {  # 配置根路径的请求处理\n    # 应用限流配置，使用之前定义的 \"one\" 区域\n    # burst=10 表示可以允许最多 10 个额外请求超出正常限速\n    # nodelay 表示在突发请求情况下，这 10 个请求将立即被处理，不会被延迟\n    limit_req zone=one burst=10 nodelay;\n\n    # 将请求转发到本地的 8080 端口\n    proxy_pass http://localhost:8080;  # 反向代理请求到后端服务\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-ikvm6g3","Type":"NodeParagraph","Properties":{"id":"20241102232929-ikvm6g3","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这样后端服务就不被流量激增影响，能够提高系统的稳定性。"}]},{"ID":"20241102232929-1o4caqp","Type":"NodeParagraph","Properties":{"id":"20241102232929-1o4caqp","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-ub6rzqg.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-qk0oo86","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-qk0oo86","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"4）虚拟主机"}]},{"ID":"20241102232929-vbz3jvf","Type":"NodeParagraph","Properties":{"id":"20241102232929-vbz3jvf","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"在企业开发中，我们为了节省成本，经常会在同一台服务器上部署多个网站项目，这时就需要使用 Nginx 的虚拟主机功能了。"}]},{"ID":"20241102232929-8whp4rj","Type":"NodeParagraph","Properties":{"id":"20241102232929-8whp4rj","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"每个网站通常就是一个虚拟主机，会有一个 server"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"name 名称对应访问网站的域名，比如我这里配置 2 台虚拟主机："}]},{"ID":"20241102232929-7iv7n8g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-7iv7n8g","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 虚拟主机1\nserver {\n    listen 80;                           # 监听 80 端口\n    server_name localhost;               # 配置域名为 example.com\n\n    root /tmp/nginx/html;           \t\t # 网站根目录\n    index localhost.html;                # 默认首页\n}\n\n# 虚拟主机2\nserver {\n    listen 80;                           # 监听 80 端口\n    server_name 127.0.0.1;               # 配置域名为 another.com\n\n    root /tmp/nginx/html;           \t\t # 网站根目录\n    index 127.html;                      # 默认首页\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-aumhzmo","Type":"NodeParagraph","Properties":{"id":"20241102232929-aumhzmo","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"配置虚拟主机后，Nginx 就能够根据请求的域名找到对应的网站配置，并处理请求。"}]},{"ID":"20241102232929-xqaqd9j","Type":"NodeParagraph","Properties":{"id":"20241102232929-xqaqd9j","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-4x8xwms.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-ightqo2","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241102232929-ightqo2","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"5）其他"}]},{"ID":"20241102232929-a866yhk","Type":"NodeParagraph","Properties":{"id":"20241102232929-a866yhk","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"除了上面这些，还有很多企业开发中可能会用到的 Nginx 高级配置和技巧。"}]},{"ID":"20241102232929-br78t6y","Type":"NodeParagraph","Properties":{"id":"20241102232929-br78t6y","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"比如可以："}]},{"ID":"20241102232929-4uxt0md","Type":"NodeList","ListData":{},"Properties":{"id":"20241102232929-4uxt0md","updated":"20241102232929"},"Children":[{"ID":"20241102232929-bmenphg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-bmenphg","updated":"20241102232929"},"Children":[{"ID":"20241102232929-7yu1qvl","Type":"NodeParagraph","Properties":{"id":"20241102232929-7yu1qvl","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"通过后端响应缓存配置，让 Nginx 直接从缓存中读取数据来响应请求，这样能够显著提升性能、减少服务器压力。"}]}]},{"ID":"20241102232929-bw83ac0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-bw83ac0","updated":"20241102232929"},"Children":[{"ID":"20241102232929-f38dexx","Type":"NodeParagraph","Properties":{"id":"20241102232929-f38dexx","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"通过正向代理的设置，Nginx 可以作为 “跳板机”，帮客户端发起请求，从而访问原本无法直接访问的资源。"}]}]},{"ID":"20241102232929-bxxm99z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-bxxm99z","updated":"20241102232929"},"Children":[{"ID":"20241102232929-2541b0y","Type":"NodeParagraph","Properties":{"id":"20241102232929-2541b0y","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"通过自定义错误页面，能够给用户提供更友好的错误提示信息。"}]}]}]},{"ID":"20241102232929-8tbo6qs","Type":"NodeParagraph","Properties":{"id":"20241102232929-8tbo6qs","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"此外，Nginx 支持 WebSocket、HTTPS 和 HTTP/2 等多种协议，还可以配置 Gzip 压缩来减少传输的数据量，进一步优化性能。"}]},{"ID":"20241102232929-4kudd44","Type":"NodeParagraph","Properties":{"id":"20241102232929-4kudd44","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"最后，Nginx 自身也支持一系列性能调优的配置，比如工作进程与连接数配置，可以从容应对高并发和大流量场景。"}]},{"ID":"20241102232929-6jcpoxa","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241102232929-6jcpoxa","updated":"20241102232929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"worker_processes auto; # 自动检测 CPU 核心数，设置工作进程数\n\nevents {\n    worker_connections 2048; # 每个工作进程的最大连接数\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241102232929-x000d27","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241102232929-x000d27","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"2、Nginx 工具和模块生态"}]},{"ID":"20241102232929-56cycgn","Type":"NodeParagraph","Properties":{"id":"20241102232929-56cycgn","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"想成为 Nginx 大圆满高手，就要懂得利用工具和生态，比如可视化工具、模块和开源项目。"}]},{"ID":"20241102232929-yh8y9wh","Type":"NodeParagraph","Properties":{"id":"20241102232929-yh8y9wh","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"首先，Nginx 的配置和运维对初学者来说可能比较复杂，这时可以利用 Nginx 官方推出的 Nginx Amplify、轻量级的 Nginx-UI 或者宝塔 Linux 服务器管理面板等可视化工具，通过图形界面来更直观地查看配置、分析流量和性能指标，从而提高操作和运维效率。"}]},{"ID":"20241102232929-eswp8y5","Type":"NodeParagraph","Properties":{"id":"20241102232929-eswp8y5","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233008-z04csap.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"Nginx UI 面板"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-c0o2ja7","Type":"NodeParagraph","Properties":{"id":"20241102232929-c0o2ja7","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"其次，Nginx 的功能并不是一成不变的，我们可以通过各种各样的模块来扩展它的能力，比如我们常用于健康检查的 nginx"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"upstream"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"check"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"module 模块、实现 JavaScript 语言扩展的 njs 模块。"}]},{"ID":"20241102232929-2d8ydhf","Type":"NodeParagraph","Properties":{"id":"20241102232929-2d8ydhf","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"但手动安装模块的过程是比较繁琐的，需要下载源码并进行编译。"}]},{"ID":"20241102232929-sr1fj23","Type":"NodeParagraph","Properties":{"id":"20241102232929-sr1fj23","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"这种情况下，我们就可以选择 OpenResty 这样一个基于 Nginx 的高性能 Web 平台，它集成了大量模块、依赖项和 Lua 脚本库，能够让你直接在 Nginx 里开发复杂的业务逻辑，充分利用 Nginx 的非阻塞 I/O 模型来提升应用的性能，适合超高并发的场景。"}]},{"ID":"20241102232929-a1o8lce","Type":"NodeParagraph","Properties":{"id":"20241102232929-a1o8lce","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"比如下图是网上的一个基于 OpenResty 实现的灰度发布架构："}]},{"ID":"20241102232929-1iwb1r0","Type":"NodeParagraph","Properties":{"id":"20241102232929-1iwb1r0","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图片"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/network-asset-640-20241102233009-pl0r0hf.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241102232929-z4plz1z","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241102232929-z4plz1z","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"四、Nginx 原理 - 化劲"}]},{"ID":"20241102232929-6xmn4nx","Type":"NodeParagraph","Properties":{"id":"20241102232929-6xmn4nx","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"想要突破为化劲强者，你需要去理解 Nginx 的核心原理，甚至是去钻研那晦涩难懂的 C 语言源码。"}]},{"ID":"20241102232929-i1xsbve","Type":"NodeParagraph","Properties":{"id":"20241102232929-i1xsbve","updated":"20241102232929"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"当然，为了应对面试，现在很多程序员迫不得已朝着化劲强者进发。"}]},{"ID":"20241102232929-k1ue1yd","Type":"NodeParagraph","Properties":{"id":"20241102232929-k1ue1yd","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"原理的学习就不是几分钟的视频能搞定的了，但是我可以帮大家划划重点。"}]},{"ID":"20241102232929-m5bay27","Type":"NodeList","ListData":{},"Properties":{"id":"20241102232929-m5bay27","updated":"20241102232929"},"Children":[{"ID":"20241102232929-bkdjodz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-bkdjodz","updated":"20241102232929"},"Children":[{"ID":"20241102232929-stg61b8","Type":"NodeParagraph","Properties":{"id":"20241102232929-stg61b8","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"负载均衡机制"}]}]},{"ID":"20241102232929-sl88lth","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-sl88lth","updated":"20241102232929"},"Children":[{"ID":"20241102232929-tc94hso","Type":"NodeParagraph","Properties":{"id":"20241102232929-tc94hso","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"事件驱动模型"}]}]},{"ID":"20241102232929-svjrvdb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-svjrvdb","updated":"20241102232929"},"Children":[{"ID":"20241102232929-wvbj0of","Type":"NodeParagraph","Properties":{"id":"20241102232929-wvbj0of","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"请求处理流程"}]}]},{"ID":"20241102232929-iscrbzx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-iscrbzx","updated":"20241102232929"},"Children":[{"ID":"20241102232929-0birkbo","Type":"NodeParagraph","Properties":{"id":"20241102232929-0birkbo","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"多进程架构"}]}]},{"ID":"20241102232929-hnzqh1b","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-hnzqh1b","updated":"20241102232929"},"Children":[{"ID":"20241102232929-tcaq0l1","Type":"NodeParagraph","Properties":{"id":"20241102232929-tcaq0l1","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"进程间通信机制"}]}]},{"ID":"20241102232929-ek197oa","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-ek197oa","updated":"20241102232929"},"Children":[{"ID":"20241102232929-axs5ja1","Type":"NodeParagraph","Properties":{"id":"20241102232929-axs5ja1","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"限流机制"}]}]},{"ID":"20241102232929-l4kq1aj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-l4kq1aj","updated":"20241102232929"},"Children":[{"ID":"20241102232929-r5suq9m","Type":"NodeParagraph","Properties":{"id":"20241102232929-r5suq9m","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"缓存机制"}]}]},{"ID":"20241102232929-h6xxiz1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-h6xxiz1","updated":"20241102232929"},"Children":[{"ID":"20241102232929-qn6ibpn","Type":"NodeParagraph","Properties":{"id":"20241102232929-qn6ibpn","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"压缩机制"}]}]},{"ID":"20241102232929-65z7co8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241102232929-65z7co8","updated":"20241102232929"},"Children":[{"ID":"20241102232929-sq52aw0","Type":"NodeParagraph","Properties":{"id":"20241102232929-sq52aw0","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"资源复用"}]}]}]},{"ID":"20241102232929-0t3uk1k","Type":"NodeParagraph","Properties":{"id":"20241102232929-0t3uk1k","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"能搞懂这些，并且融会贯通，你就能够更自如地优化 Nginx 的性能和可用性等等，也就超过 99% 的程序员了。"}]},{"ID":"20241102232929-q9bxk69","Type":"NodeParagraph","Properties":{"id":"20241102232929-q9bxk69","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"当然，编程是学不完的，真正的 Nginx 绝世高手，可以给 Nginx 贡献代码，甚至是自立门户、手写 Nginx 的竞品。"}]},{"ID":"20241102232929-yp4i4lb","Type":"NodeParagraph","Properties":{"id":"20241102232929-yp4i4lb","updated":"20241102232929"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"我相信看到这里的小伙伴中肯定会出现绝世高手~"}]},{"ID":"20241102232929-a13k352","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241102232929-a13k352","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"结尾"}]},{"ID":"20241102232929-2wd663q","Type":"NodeParagraph","Properties":{"id":"20241102232929-2wd663q","updated":"20241102232929"},"Children":[{"Type":"NodeText","Data":"最后，我把这份 Nginx 学习路线文字版、以及常问的面试题都放到了自己的公众号，还有更多学习路线也可免费获取。点击下方关注后，点击菜单的 “免费资源” 即可获取"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"~"}]}]},{"ID":"20241102232809-rjwgzmf","Type":"NodeParagraph","Properties":{"id":"20241102232809-rjwgzmf","updated":"20241102232809"}},{"ID":"20241102232809-01hybgv","Type":"NodeParagraph","Properties":{"id":"20241102232809-01hybgv","updated":"20241102232809"}}]}