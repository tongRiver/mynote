{"ID":"20241029223008-w8mw4kf","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241029223008-w8mw4kf","title":"Docker容器开机自启动","type":"doc","updated":"20241031155916"},"Children":[{"ID":"20241031155802-uhuu3hn","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20241031155802-uhuu3hn","updated":"20241031155809"},"Children":[{"Type":"NodeText","Data":"简明"}]},{"ID":"20241029223008-03ae4pi","Type":"NodeParagraph","Properties":{"id":"20241029223008-03ae4pi","updated":"20241031155609"},"Children":[{"Type":"NodeText","Data":"使用命令："}]},{"ID":"20241031155610-jv5ksyc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155610-jv5ksyc","updated":"20241031155706"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker update --restart unless-stopped myredis1\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155654-spy6ghn","Type":"NodeParagraph","Properties":{"id":"20241031155654-spy6ghn","updated":"20241031155657"},"Children":[{"Type":"NodeText","Data":"检查一下："}]},{"ID":"20241031155657-q244fat","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155657-q244fat","updated":"20241031155707"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker inspect -f '{{.HostConfig.RestartPolicy.Name}}' myredis1\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155735-p7wmj5n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155735-p7wmj5n","updated":"20241031155740"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"[root@localhost ~]# docker inspect -f '{{.HostConfig.RestartPolicy.Name}}' myredis1\nunless-stopped\n[root@localhost ~]#\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155742-ggkq9w2","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20241031155742-ggkq9w2","updated":"20241031155916"},"Children":[{"Type":"NodeText","Data":"参考"}]},{"ID":"20241031155838-tl5in4j","Type":"NodeParagraph","Properties":{"id":"20241031155838-tl5in4j","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"要让 Docker 容器在虚拟机开机时自动启动，你可以使用 Docker 提供的重启策略来实现。具体步骤如下："}]},{"ID":"20241031155838-9fq0mrk","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241031155838-9fq0mrk","updated":"20241031155905"},"Children":[{"ID":"20241031155838-eb89wc7","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241031155838-eb89wc7","updated":"20241031155838"},"Children":[{"ID":"20241031155838-ycaswxz","Type":"NodeParagraph","Properties":{"id":"20241031155838-ycaswxz","updated":"20241031155838"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"修改现有容器的重启策略"},{"Type":"NodeText","Data":"：\n如果这些容器已经在运行，你可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker update"},{"Type":"NodeText","Data":"​ 命令来设置它们的重启策略。例如，如果你的 nginx 容器名是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my-nginx"},{"Type":"NodeText","Data":"​，你可以这样设置："}]},{"ID":"20241031155838-jip8lnu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155838-jip8lnu","updated":"20241031155838"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker update --restart unless-stopped my-nginx\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155838-r5bxct1","Type":"NodeParagraph","Properties":{"id":"20241031155838-r5bxct1","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"对于其他的容器，如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"mysql"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"redis"},{"Type":"NodeText","Data":"​，你可以类似地更新："}]},{"ID":"20241031155838-m2awwsw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155838-m2awwsw","updated":"20241031155838"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker update --restart unless-stopped my-mysql\ndocker update --restart unless-stopped my-redis\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20241031155838-u2ta1nc","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241031155838-u2ta1nc","updated":"20241031155838"},"Children":[{"ID":"20241031155838-tna0wni","Type":"NodeParagraph","Properties":{"id":"20241031155838-tna0wni","updated":"20241031155838"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"启动容器时设置重启策略"},{"Type":"NodeText","Data":"：\n如果你是从头启动容器，或者需要重新创建容器，可以在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker run"},{"Type":"NodeText","Data":"​ 命令中加上 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--restart"},{"Type":"NodeText","Data":"​ 参数。例如："}]},{"ID":"20241031155838-we3xvpg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155838-we3xvpg","updated":"20241031155838"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker run -d --name my-nginx --restart unless-stopped nginx\ndocker run -d --name my-mysql --restart unless-stopped mysql\ndocker run -d --name my-redis --restart unless-stopped redis\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20241031155838-lg7em40","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241031155838-lg7em40","updated":"20241031155905"},"Children":[{"ID":"20241031155838-c4jsoag","Type":"NodeParagraph","Properties":{"id":"20241031155838-c4jsoag","updated":"20241031155838"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"重启策略选项"},{"Type":"NodeText","Data":"："}]},{"ID":"20241031155838-b02vmhg","Type":"NodeList","ListData":{},"Properties":{"id":"20241031155838-b02vmhg","updated":"20241031155905"},"Children":[{"ID":"20241031155838-u80jsxk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241031155838-u80jsxk","updated":"20241031155838"},"Children":[{"ID":"20241031155838-pvwu3cn","Type":"NodeParagraph","Properties":{"id":"20241031155838-pvwu3cn","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"no"},{"Type":"NodeText","Data":"​：默认值，容器退出时不会自动重启。"}]}]},{"ID":"20241031155838-zc5ufc5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241031155838-zc5ufc5","updated":"20241031155838"},"Children":[{"ID":"20241031155838-vdyk6jq","Type":"NodeParagraph","Properties":{"id":"20241031155838-vdyk6jq","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​：无论退出状态如何，都尝试自动重启容器。"}]}]},{"ID":"20241031155838-c6t05kj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241031155838-c6t05kj","updated":"20241031155905"},"Children":[{"ID":"20241031155838-0u7v04y","Type":"NodeParagraph","Properties":{"id":"20241031155838-0u7v04y","updated":"20241031155905"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unless-stopped"},{"Type":"NodeText","Data":"​：类似于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​，但"},{"Type":"NodeTextMark","TextMarkType":"mark","TextMarkTextContent":"如果容器是手动停止的，则不会自动重启"},{"Type":"NodeText","Data":"。"}]}]},{"ID":"20241031155838-n0jsu3v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241031155838-n0jsu3v","updated":"20241031155838"},"Children":[{"ID":"20241031155838-6demjoc","Type":"NodeParagraph","Properties":{"id":"20241031155838-6demjoc","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"on-failure[:max-retries]"},{"Type":"NodeText","Data":"​：仅当容器非正常退出时才会自动重启，可以选择性地添加最大重试次数。"}]}]}]}]}]},{"ID":"20241031155838-o6apr4o","Type":"NodeParagraph","Properties":{"id":"20241031155838-o6apr4o","updated":"20241031155838"},"Children":[{"Type":"NodeText","Data":"通过上述方法配置好容器后，每当虚拟机重启时，Docker 会根据设置的策略自动重启容器，你就能够直接访问这些服务。"}]},{"ID":"20241031155837-9b67po9","Type":"NodeParagraph","Properties":{"id":"20241031155837-9b67po9","updated":"20241031155837"}},{"ID":"20241031155916-nawvhcn","Type":"NodeParagraph","Properties":{"id":"20241031155916-nawvhcn","updated":"20241031155916"}},{"ID":"20241031155824-a9fau5x","Type":"NodeParagraph","Properties":{"id":"20241031155824-a9fau5x","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"要让 Docker 容器在虚拟机开机时自动启动，你可以使用 Docker 的重启策略。以下是具体步骤："}]},{"ID":"20241031155824-hkkqtr4","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241031155824-hkkqtr4","updated":"20241031155824"},"Children":[{"ID":"20241031155824-6z4s1br","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241031155824-6z4s1br","updated":"20241031155824"},"Children":[{"ID":"20241031155824-ew5ajwb","Type":"NodeParagraph","Properties":{"id":"20241031155824-ew5ajwb","updated":"20241031155824"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"重启策略设置"},{"Type":"NodeText","Data":"："}]},{"ID":"20241031155824-sxcgku8","Type":"NodeParagraph","Properties":{"id":"20241031155824-sxcgku8","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"你可以通过设置 Docker 容器的重启策略来实现开机自启动。Docker 提供了几种重启策略："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"no"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unless-stopped"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"on-failure"},{"Type":"NodeText","Data":"​。其中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unless-stopped"},{"Type":"NodeText","Data":"​ 是最常用的用于自动重启的选项。"}]},{"ID":"20241031155824-icvqpj7","Type":"NodeParagraph","Properties":{"id":"20241031155824-icvqpj7","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"运行以下命令来更新你的 Docker 容器以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​ 重启策略："}]},{"ID":"20241031155824-rezdfnv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155824-rezdfnv","updated":"20241031155824"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker update --restart always \u003ccontainer_name_or_id\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155824-5ax0fpn","Type":"NodeParagraph","Properties":{"id":"20241031155824-5ax0fpn","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"其中 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;container_name_or_id\u0026gt;"},{"Type":"NodeText","Data":"​ 是你要设置的容器的名称或 ID，比如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"mysql"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"redis"},{"Type":"NodeText","Data":"​。"}]}]},{"ID":"20241031155824-b90qrvx","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241031155824-b90qrvx","updated":"20241031155824"},"Children":[{"ID":"20241031155824-mojaiws","Type":"NodeParagraph","Properties":{"id":"20241031155824-mojaiws","updated":"20241031155824"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"检查配置"},{"Type":"NodeText","Data":"："}]},{"ID":"20241031155824-cs4fc18","Type":"NodeParagraph","Properties":{"id":"20241031155824-cs4fc18","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"确保镜像和容器的配置没有问题，可以通过以下命令查看重启策略是否设置成功："}]},{"ID":"20241031155824-k72tgr0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155824-k72tgr0","updated":"20241031155824"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker inspect -f '{{.HostConfig.RestartPolicy.Name}}' \u003ccontainer_name_or_id\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241031155824-8lcv48g","Type":"NodeParagraph","Properties":{"id":"20241031155824-8lcv48g","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"如果输出为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​，则说明设置成功。"}]}]},{"ID":"20241031155824-ixth5zs","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241031155824-ixth5zs","updated":"20241031155824"},"Children":[{"ID":"20241031155824-69ip0aa","Type":"NodeParagraph","Properties":{"id":"20241031155824-69ip0aa","updated":"20241031155824"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"重启 Docker 服务"},{"Type":"NodeText","Data":"："}]},{"ID":"20241031155824-i7jqtna","Type":"NodeParagraph","Properties":{"id":"20241031155824-i7jqtna","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"在某些系统上，可能需要重启 Docker 服务来使配置生效："}]},{"ID":"20241031155824-qxfpafv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241031155824-qxfpafv","updated":"20241031155824"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"sudo systemctl restart docker\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20241031155824-n78bg8y","Type":"NodeParagraph","Properties":{"id":"20241031155824-n78bg8y","updated":"20241031155824"},"Children":[{"Type":"NodeText","Data":"通过上述配置，当 Docker 守护进程启动时，这些容器会按照 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"always"},{"Type":"NodeText","Data":"​ 策略被重新启动。这在系统重启时同样有效。希望这个方法能帮助到你！"}]},{"ID":"20241031155826-5hr7n00","Type":"NodeParagraph","Properties":{"id":"20241031155826-5hr7n00","updated":"20241031155826"}},{"ID":"20241031155827-6gznsmf","Type":"NodeParagraph","Properties":{"id":"20241031155827-6gznsmf","updated":"20241031155827"}}]}